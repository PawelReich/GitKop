Version 4
SHEET 1 1920 840
WIRE -832 -800 -912 -800
WIRE -720 -800 -720 -848
WIRE -720 -800 -832 -800
WIRE 512 -784 400 -784
WIRE 640 -784 640 -864
WIRE 640 -784 512 -784
WIRE 720 -784 640 -784
WIRE 880 -784 800 -784
WIRE -832 -768 -832 -800
WIRE 400 -720 400 -784
WIRE 512 -720 512 -784
WIRE 640 -720 640 -784
WIRE -912 -688 -912 -720
WIRE -832 -688 -832 -704
WIRE -832 -688 -912 -688
WIRE -720 -672 -720 -800
WIRE -752 -656 -944 -656
WIRE -608 -640 -688 -640
WIRE -912 -624 -912 -688
WIRE -784 -624 -912 -624
WIRE -752 -624 -784 -624
WIRE 400 -624 400 -656
WIRE 464 -624 400 -624
WIRE 512 -624 512 -656
WIRE 512 -624 464 -624
WIRE -608 -608 -608 -640
WIRE -784 -592 -784 -624
WIRE 304 -560 224 -560
WIRE 464 -560 464 -624
WIRE 464 -560 384 -560
WIRE 640 -560 640 -640
WIRE 640 -560 464 -560
WIRE 880 -560 880 -784
WIRE 880 -560 640 -560
WIRE -720 -512 -720 -608
WIRE -720 -512 -784 -512
WIRE -720 -496 -720 -512
WIRE -944 -464 -944 -656
WIRE -608 -464 -608 -528
WIRE -608 -464 -944 -464
WIRE -944 -352 -944 -464
WIRE -608 -352 -608 -384
WIRE -448 -352 -608 -352
WIRE -368 -352 -448 -352
WIRE -608 -240 -608 -272
WIRE -448 -240 -448 -272
WIRE 160 -192 160 -288
WIRE 704 -112 400 -112
WIRE -1040 -96 -1040 -160
WIRE -992 -96 -1040 -96
WIRE -896 -96 -928 -96
WIRE 160 -64 160 -112
WIRE 208 -64 160 -64
WIRE 336 -64 288 -64
WIRE 160 -48 160 -64
WIRE -1040 0 -1040 -96
WIRE -992 0 -1040 0
WIRE -896 0 -896 -96
WIRE -896 0 -928 0
WIRE -864 0 -896 0
WIRE -64 0 -160 0
WIRE 96 0 16 0
WIRE -1040 64 -1040 0
WIRE 880 64 880 -560
WIRE -736 112 -736 64
WIRE 160 144 160 48
WIRE 704 144 704 -112
WIRE 832 144 704 144
WIRE 704 160 704 144
WIRE -1040 176 -1040 128
WIRE -800 176 -800 112
WIRE -736 176 -736 112
WIRE -592 176 -592 64
WIRE 400 192 400 -16
WIRE 704 272 704 240
WIRE 880 272 880 160
WIRE 880 272 704 272
WIRE 704 320 704 272
WIRE -1040 336 -1040 256
WIRE -736 336 -736 256
WIRE -592 336 -592 256
FLAG -592 336 0
FLAG -1040 336 0
FLAG -1040 -160 VCC
IOPIN -1040 -160 Out
FLAG 160 -288 VCC
IOPIN 160 -288 In
FLAG 704 320 0
FLAG 640 -864 VCC
IOPIN 640 -864 In
FLAG -720 -848 VCC
FLAG -720 -496 0
FLAG -608 -240 0
FLAG -368 -352 OUT
IOPIN -368 -352 Out
FLAG 400 192 VCC
IOPIN 400 192 In
FLAG 160 144 0
FLAG -944 -352 PULSE
IOPIN -944 -352 In
FLAG 160 -560 PULSE
IOPIN 160 -560 Out
FLAG -864 0 0
FLAG -592 64 CLK
IOPIN -592 64 Out
FLAG -160 0 CLK
IOPIN -160 0 In
FLAG -736 64 VCC
IOPIN -736 64 In
FLAG -736 336 0
FLAG -448 -240 0
FLAG -800 176 0
SYMBOL voltage -592 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName CLK
SYMATTR Value PULSE(0 3.3 0.5m 1u 1u 1m 2m 1)
SYMBOL res 32 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL pnp 336 -112 R0
SYMATTR InstName Q1
SYMATTR Value BC557B
SYMBOL voltage -1040 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName BAT
SYMATTR Value 7.4
SYMBOL res 688 144 R0
SYMATTR InstName R3
SYMATTR Value 100
SYMBOL nmos 832 64 R0
SYMATTR InstName M1
SYMATTR Value IRF740
SYMBOL ind 704 -768 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 400µ
SYMBOL res 624 -736 R0
SYMATTR InstName R4
SYMATTR Value 400
SYMBOL res 400 -576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 400
SYMBOL cap 224 -576 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 1000µ
SYMBOL OpAmps\\UniversalOpAmp2 -720 -640 R0
SYMATTR InstName U1
SYMBOL res -800 -608 R0
SYMATTR InstName R6
SYMATTR Value 62k
SYMBOL res -928 -816 R0
SYMATTR InstName R7
SYMATTR Value 47k
SYMBOL polcap -848 -768 R0
SYMATTR InstName C2
SYMATTR Value 1000µ
SYMBOL res -624 -624 R0
SYMATTR InstName R8
SYMATTR Value 2Meg
SYMBOL res -624 -480 R0
SYMATTR InstName R9
SYMATTR Value 20k
SYMBOL res -624 -368 R0
SYMATTR InstName R10
SYMATTR Value 50k
SYMBOL npn 96 -48 R0
SYMATTR InstName Q2
SYMATTR Value BC547B
SYMBOL res 144 -208 R0
SYMATTR InstName R11
SYMATTR Value 6.8k
SYMBOL res 304 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL diode 384 -720 R0
WINDOW 3 141 60 Left 2
SYMATTR Value 1N4148
SYMATTR InstName D2
SYMBOL diode 528 -656 R180
WINDOW 0 24 64 Left 2
WINDOW 3 139 5 Left 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL diode -1024 128 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4007
SYMBOL polcap -992 16 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C4
SYMATTR Value 4700µ
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=25 Irms=3 Rser=0.017 Lser=0 mfg="Panasonic" pn="ECA1EFQ472" type="Al electrolytic"
SYMBOL current -736 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName ESP32
SYMATTR Value 0.15
SYMBOL res -464 -368 R0
SYMATTR InstName R13
SYMATTR Value 1Meg
SYMBOL polcap -992 -80 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C3
SYMATTR Value 4700µ
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=16 Irms=1.56 Rser=0.045 Lser=0 mfg="Nichicon" pn="UPR1C472MRH" type="Al electrolytic"
SYMBOL cap -736 96 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 0.47µ
SYMATTR SpiceLine V=10 Irms=3.75 Rser=0.0298746 Lser=0 mfg="KEMET" pn="C1210C474K8RAC" type="X7R"
TEXT -536 464 Left 2 !.tran 0 2m 0 100n
TEXT -544 552 Left 2 !.meas pulse_work_2_5msec INTEG (-v(n009)*i(bat))\n.meas pulse_work PARAM pulse_work_2_5msec*400\n.meas idle_work PARAM i(esp32)*5*1\n.meas avg_work PARAM (pulse_work + idle_work*9)/10\n.meas bat_capacity PARAM 9.6*3600\n.meas bat_time_sec PARAM bat_capacity/avg_work\n.meas bat_time_min PARAM bat_time_sec/60\n.meas bat_time_hr PARAM bat_time_min/60
TEXT -416 824 Left 2 !.meas IMAX MAX I(L1)
TEXT 848 448 Left 2 !.model IRF740 NMOS(Level=3 Gamma=0 Delta=0 Eta=0 Theta=0 Kappa=0.2 Vmax=0 Xj=0\n+ Tox=100n Uo=600 Phi=.6 Rs=8.563m Kp=20.59u W=.78 L=2u Vto=3.657\n+ Rd=.3915 Rds=1.778MEG Cbd=1.419n Pb=.8 Mj=.5 Fc=.5 Cgso=1.392n\n+ Cgdo=146.6p Rg=.9088 Is=17.65p N=1 Tt=570n)\n* IR pid=IRF740 case=TO220
